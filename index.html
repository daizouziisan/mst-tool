
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>睡眠記録</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { margin: 0; font-family: 'Noto Sans JP', sans-serif; background: #dff6fd; color: #000; }
    .header, .footer { padding: 1rem; text-align: center; }
    .header-form { display: flex; flex-direction: column; align-items: center; gap: 0.5rem; margin-top: 1rem; }
    .header-form label { display: flex; justify-content: center; align-items: center; gap: 0.5rem; }
    .header-form input[type="time"], .header-form input[type="number"],
    input[type="time"] { padding: 0.1rem; border-radius: 4px; border: 1px solid #aaa; width: 60px; text-align: center; }
    .suggestions { margin-top: 1rem; text-align: center; }
    .suggestion-item { margin: 0.3rem 0; }
    .day-block { margin: 1rem auto; background: #f0fbff; padding: 1rem; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); max-width: 440px; text-align: center; }
    .day-title { font-size: 1.2rem; margin-bottom: 0.5rem; color: #007acc; }
    .table-grid { display: grid; grid-template-columns: 1fr 0.3fr 1fr 0.8fr 1fr 1fr; align-items: center; text-align: center; font-size: 0.9rem; margin-bottom: 0.3rem; }
    .input-cell { display: flex; justify-content: center; }
    button { background: #66ccff; border: none; padding: 0.4rem 0.8rem; border-radius: 6px; font-size: 0.9rem; cursor: pointer; margin: 0.5rem auto; display: block; }
    canvas { max-width: 95%; margin: 1rem auto; display: block; background: #e9faff; }
    .stars { margin-top: 1rem; text-align: center; }
    .stars img { width: 60px; margin: 0 5px; }
  </style>
</head>
<body>
<div class="header">
  <h2>睡眠スケジュール</h2>
  <div class="header-form">
    <label>就寝予定時刻:<input type="time" id="plannedStart"></label>
    <label>希望睡眠時間(分):<input type="number" id="desiredDuration" min="0" max="1440" step="1"></label>
    <label>MST:<input type="time" id="targetMST"></label>
    <button onclick="suggestSleepTime()">提案</button>
    <div class="suggestions" id="suggestionResult"></div>
  </div>
</div>
<!-- その他のコード省略 -->
<script>
function timeToMin(t) {
  if (!t) return null;
  const [h, m] = t.split(":").map(Number);
  return h * 60 + m;
}
function minToTime(min) {
  min = (min + 1440) % 1440;
  const h = Math.floor(min / 60).toString().padStart(2, "0");
  const m = Math.floor(min % 60).toString().padStart(2, "0");
  return `${h}:${m}`;
}
function suggestSleepTime() {
  const start = timeToMin(document.getElementById("plannedStart").value);
  const duration = parseInt(document.getElementById("desiredDuration").value);
  const targetMST = timeToMin(document.getElementById("targetMST").value);
  if (start == null || isNaN(duration) || targetMST == null) {
    document.getElementById("suggestionResult").innerText = "入力が不完全です。"; return;
  }
  const results = [];
  for (let offset = 0; offset <= 120; offset += 5) {
    for (let s = start; s < start + 120; s += 5) {
      const e = (s + offset) % 1440;
      const mst = (s + offset / 2) % 1440;
      let diff = Math.abs(mst - targetMST);
      if (diff > 720) diff = 1440 - diff;
      if (diff <= 30) results.push({ s, e, mst, len: offset });
    }
  }
  results.sort((a, b) => a.s - b.s);
  const resultDiv = document.getElementById("suggestionResult");
  resultDiv.innerHTML = results.slice(0, 3).map(r => `<div class="suggestion-item">${minToTime(r.s)}〜${minToTime(r.e)} MST:${minToTime(r.mst)}</div>`).join("");
  if (results.length === 0) resultDiv.innerText = "適した時間帯が見つかりません。";
}
</script>
</body>
</html>
